machine:
    node:
        version: 7.10.0
    services:
        - docker

dependencies:
    post:
        - rm -r ~/.gradle || true

test:
    override:
        - go test -v -race $(go list ./... | grep -v /vendor/)
        - npm install -g @angular/core 
        - npm install -g @angular/cli 
        - cd db-tool && npm install && ng build --prod --base-href="./"

deployment:
    production:
        branch: master
        commands:
            - docker build -t byuoitav/configuration-database-tool:$CIRCLE_SHA1 .
            - docker build -t byuoitav/configuration-database-tool:latest .
            - docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
            - docker push byuoitav/configuration-database-tool:$CIRCLE_SHA1
            - docker push byuoitav/configuration-database-tool:latest
